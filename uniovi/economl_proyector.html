<!DOCTYPE html>
<html lang="es"><head>
<script src="economl_proyector_files/libs/clipboard/clipboard.min.js"></script>
<script src="economl_proyector_files/libs/quarto-html/tabby.min.js"></script>
<script src="economl_proyector_files/libs/quarto-html/popper.min.js"></script>
<script src="economl_proyector_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="economl_proyector_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="economl_proyector_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="economl_proyector_files/libs/quarto-html/quarto-syntax-highlighting-c70d880e88d09672f81c164feab79f78.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">
<meta name="author" content="Juan D. Montoro-Pons">
<title>Métodos de Aprendizaje Automático para la Economía Aplicada</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
<link rel="stylesheet" href="economl_proyector_files/libs/revealjs/dist/reset.css">
<link rel="stylesheet" href="economl_proyector_files/libs/revealjs/dist/reveal.css">
<style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #657b83; background-color: #fdf6e3; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #657b83; } /* Normal */
    code span.al { color: #d33682; font-weight: bold; } /* Alert */
    code span.an { color: #268bd2; } /* Annotation */
    code span.at { color: #268bd2; } /* Attribute */
    code span.bn { color: #2aa198; } /* BaseN */
    code span.bu { color: #cb4b16; } /* BuiltIn */
    code span.cf { color: #859900; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #2aa198; } /* Char */
    code span.cn { color: #2aa198; font-weight: bold; } /* Constant */
    code span.co { color: #93a1a1; font-style: italic; } /* Comment */
    code span.cv { color: #2aa198; } /* CommentVar */
    code span.do { color: #dc322f; } /* Documentation */
    code span.dt { color: #b58900; font-weight: bold; } /* DataType */
    code span.dv { color: #2aa198; } /* DecVal */
    code span.er { color: #dc322f; text-decoration: underline; } /* Error */
    code span.ex { color: #268bd2; font-weight: bold; } /* Extension */
    code span.fl { color: #2aa198; } /* Float */
    code span.fu { color: #268bd2; } /* Function */
    code span.im { color: #2aa198; } /* Import */
    code span.in { color: #b58900; } /* Information */
    code span.kw { color: #859900; font-weight: bold; } /* Keyword */
    code span.op { color: #859900; } /* Operator */
    code span.ot { color: #859900; } /* Other */
    code span.pp { color: #cb4b16; } /* Preprocessor */
    code span.re { color: #268bd2; background-color: #eee8d5; } /* RegionMarker */
    code span.sc { color: #dc322f; } /* SpecialChar */
    code span.ss { color: #dc322f; } /* SpecialString */
    code span.st { color: #2aa198; } /* String */
    code span.va { color: #268bd2; } /* Variable */
    code span.vs { color: #2aa198; } /* VerbatimString */
    code span.wa { color: #cb4b16; } /* Warning */
  </style>
<link rel="stylesheet" href="economl_proyector_files/libs/revealjs/dist/theme/quarto-c943df322edfbda1944bdbe3ad71442d.css">
<link href="economl_proyector_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
<link href="economl_proyector_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
<link href="economl_proyector_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
<link href="economl_proyector_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
<style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
<script src="economl_proyector_files/libs/kePrint-0.0.1/kePrint.js"></script><link href="economl_proyector_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">
</head>
<body class="quarto-light">
<script src="_extensions/clean/mathjax-config.js"></script><div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center"><h1 class="title">Métodos de Aprendizaje Automático para la Economía Aplicada</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Juan D. Montoro-Pons 
</div>
<div class="quarto-title-author-email">
<a href="mailto:juan.d.montoro@uv.es">juan.d.montoro@uv.es</a>
</div>
        <p class="quarto-title-affiliation">
            Departamento de Economía Aplicada, Universitat de València
          </p>
    </div>
</div>

  <p class="date">7 de noviembre de 2025</p>
</section><section><section id="introducción" class="title-slide slide level1 center" data-background-color="#115a72"><h1>Introducción</h1>

</section><section id="conceptos" class="slide level2" style="color:#115a72"><h2>Conceptos</h2>
<p>&nbsp;</p>
<ul>
<li>Aprendizaje automático e IA</li>
<li>La inteligencia como un problema empírico predictivo</li>
<li>Datos y <em>big data</em>
</li>
</ul>
<p>&nbsp;</p>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Modelos de aprendizaje automático</strong></p>
</div>
<div class="callout-content">
<ul>
<li>¿Cómo funcionan?</li>
<li>¿Puedo aplicarlos en la práctica en economía?</li>
</ul>
</div>
</div>
</div>
</section><section id="como-funciona" class="slide level2" style="color:#115a72"><h2>¿Como funciona?</h2>
<p>&nbsp;</p>
<ul>
<li>Modelos predictivos flexibles</li>
<li>Énfasis en la generalización (capacidad de predicción fuera de la muestra de ajuste)</li>
<li>Métodos de optimización adaptados a contextos <em>big data</em> (escalables para tamaño de muestra <span class="math inline">\(n\)</span> grande y/o número elevado de predictores <span class="math inline">\(p\)</span>, incluso <span class="math inline">\(p&gt;n\)</span>)</li>
</ul></section><section id="puedo-aplicarlo-en-economía" class="slide level2" style="color:#115a72"><h2>¿Puedo aplicarlo en economía?</h2>
<p>&nbsp;</p>
<ul>
<li>Tareas de predicción:
<ul>
<li>Contrastar teorías con contenido predictivo</li>
<li>Técnicas estadísticas y econométricas con contenido predictivo</li>
</ul>
</li>
<li>Modelización con <em>big data</em>
<ul>
<li>Elevada dimensionalidad en el espacio de predictores</li>
<li>Uso de datos no estructurados</li>
</ul>
</li>
<li>Inferencia causal
<ul>
<li>Complejidad en relaciones funcionales y/o elevada dimensionalidad en el espacio de variables de confusión</li>
<li>Estimación de efectos heterogéneos</li>
</ul>
</li>
</ul></section><section id="algunas-referencias" class="slide level2" style="color:#115a72"><h2>Algunas referencias</h2>
<p>&nbsp;</p>
<p><a href="https://doi.org/10.1214/ss/1009213726">Leo Breiman. “Statistical Modeling: The Two Cultures (with comments and a rejoinder by the author).” Statist. Sci. 16 (3) 199 - 231, August 2001.</a></p>
<p><a href="https://www.aeaweb.org/articles?id=10.1257/jep.28.2.3">Varian, Hal R. 2014. “Big Data: New Tricks for Econometrics.” Journal of Economic Perspectives 28 (2): 3–28.</a></p>
<p><a href="https://www.aeaweb.org/articles?id=10.1257/jep.31.2.87">Mullainathan, Sendhil, and Jann Spiess. 2017. “Machine Learning: An Applied Econometric Approach.” Journal of Economic Perspectives 31 (2): 87–106.</a></p>
<p><a href="https://doi.org/10.1146/annurev-economics-080217-053433">Athey, Susan, and Guido W. Imbens. “Machine learning methods that economists should know about.” Annual Review of Economics 11.1 (2019): 685-725.</a></p>
<p><a href="https://causalml-book.org/">Chernozhukov, V. &amp; Hansen, C. &amp; Kallus, N. &amp; Spindler, M. &amp; Syrgkanis, V. (2024): Applied Causal Inference Powered by ML and AI. CausalML-book.org; arXiv:2403.02467.</a></p>
</section></section><section><section id="los-ingredientes" class="title-slide slide level1 center" data-background-color="#115a72"><h1>Los ingredientes</h1>

</section><section id="definición-del-problema" class="slide level2" style="color:#115a72"><h2>Definición del problema</h2>
<p>&nbsp;</p>
<p>Sea una relación entre una respuesta <span class="math inline">\(y\)</span>, y un conjunto de <span class="math inline">\(p\)</span> predictores <span class="math inline">\((x_1,x_2,\ldots,x_p)\)</span>:</p>
<p><span class="math display">\[y = g(X) + \epsilon\]</span></p>
<blockquote>
<p><strong>Objetivo</strong>: estimar <span class="math inline">\(g\)</span> con fines predictivos, <span class="math inline">\(\hat{y} = \hat{g}(X)\)</span>.</p>
</blockquote>
</section><section id="componentes-básicos" class="slide level2 scrollable" style="color:#115a72"><h2>Componentes básicos</h2>
<p>&nbsp;</p>
<ol type="1">
<li><p>Una forma funcional <span class="math inline">\(g\)</span></p></li>
<li><p>Un <strong>regularizador</strong> para controlar la complejidad de <span class="math inline">\(g\)</span> (objetivo: no ajustar el ruido).</p></li>
<li>
<p>Una estrategia de <strong>partición de muestra</strong> y <strong>remuestreo</strong> para la evaluación y selección de modelos:</p>
<ul>
<li>Selección empírica de la cantidad óptima de regularización (<em>hiperparámetros</em> o <em>tuning parameters</em>) por remuestreo (<em>validación cruzada</em>).</li>
<li>Evaluación de la capacidad predictiva fuera de muestra.</li>
</ul>
</li>
</ol>
<blockquote>
<p>Algoritmo de aprendizaje estadístico = <span class="math inline">\(g\)</span> + <em>regularizador</em>.</p>
</blockquote>
</section><section id="subajuste-y-sobreajuste" class="slide level2" style="color:#115a72"><h2>Subajuste y sobreajuste</h2>
<p>&nbsp;</p>

<img data-src="economl_proyector_files/figure-revealjs/unnamed-chunk-2-1.png" width="1152" class="r-stretch"></section><section id="error-fuera-de-muestra" class="slide level2" style="color:#115a72"><h2>Error fuera de muestra</h2>

<img data-src="pics/biasvariance.png" class="r-stretch"></section><section id="evaluación-por-validación-cruzada" class="slide level2" style="color:#115a72"><h2>Evaluación por validación cruzada</h2>

<img data-src="pics/crossvalidation.webp" class="r-stretch"></section></section><section><section id="del-modelo-al-algoritmo-regresión-lineal-árboles-y-ensambles" class="title-slide slide level1 center" data-background-color="#115a72"><h1>Del modelo al algoritmo: regresión lineal, árboles y ensambles</h1>

</section><section id="modelo-lineal-regularizado" class="slide level2" style="color:#115a72"><h2>Modelo lineal regularizado</h2>
<p>&nbsp;</p>
<ul>
<li><p>Extensión del modelo lineal que incorpora un término de penalización para evitar sobreajuste y mejorar la generalización.</p></li>
<li><p>La penalización o regularización controla la complejidad del modelo reduciendo el impacto de coeficientes muy grandes (ayuda con multicolinealidad y/o elevada dimensionalidad <span class="math inline">\(p\)</span>).</p></li>
<li>
<p>Tipos de penalización en el modelo lineal:</p>
<ul>
<li>Ridge (regularización L2): penaliza la suma de los cuadrados de los coeficientes. <span class="math display">\[SSR+ \lambda \sum_{j=1}^p(\beta_j^2) \]</span>
</li>
<li>Lasso (regularización L1): Penaliza la suma de los valores absolutos, favoreciendo la selección de variables.<br><span class="math display">\[SSR+ \lambda \sum_{j=1}^p|\beta_j| \]</span>
</li>
</ul>
</li>
</ul></section><section id="modelo-lineal-regularizado-1" class="slide level2" style="color:#115a72"><h2>Modelo lineal regularizado</h2>
<p>&nbsp;</p>
<ul>
<li><p>Elección independiente de la magnitud de la regularización <span class="math inline">\(\lambda\)</span>: para cada valor de <span class="math inline">\(\lambda\)</span> existe un conjunto de coeficientes estimados</p></li>
<li><p>¿Qué valor <span class="math inline">\(\lambda\)</span>? Elegir el que tenga una mayor capacidad predictiva fuera de muestra (validación cruzada)</p></li>
<li>
<p>¿Qué modelo?</p>
<ul>
<li>Lasso: selección de variables (modelos dispersos)</li>
<li>Ridge: problemas de multicolinealidad (modelos densos)</li>
</ul>
</li>
</ul></section><section id="ejemplo-modelo-lineal-con-penalización" class="slide level2" style="color:#115a72"><h2>Ejemplo: modelo lineal con penalización</h2>
<p>&nbsp;</p>
<div class="panel-tabset">
<ul id="tabset-2" class="panel-tabset-tabby">
<li><a data-tabby-default="" href="#tabset-2-1">Estimación Lasso</a></li>
<li><a href="#tabset-2-2">Estimación Ridge</a></li>
<li><a href="#tabset-2-3">Capacidad predictiva</a></li>
</ul>
<div class="tab-content">
<div id="tabset-2-1">
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Código</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href=""></a><span class="fu">library</span>(glmnet)</span>
<span id="cb4-2"><a href=""></a><span class="fu">library</span>(dplyr)</span>
<span id="cb4-3"><a href=""></a><span class="fu">library</span>(caret)</span>
<span id="cb4-4"><a href=""></a></span>
<span id="cb4-5"><a href=""></a><span class="co"># Datos: alojamientos AIRBNB en la ciudad de Valencia</span></span>
<span id="cb4-6"><a href=""></a>url <span class="ot">&lt;-</span> <span class="st">"https://juandmontoro.github.io/bigDataEco/data/airbnb.csv"</span></span>
<span id="cb4-7"><a href=""></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(url)</span>
<span id="cb4-8"><a href=""></a></span>
<span id="cb4-9"><a href=""></a><span class="co"># Realizamos una partición de datos: entrenamiento(70%)/prueba(30%)</span></span>
<span id="cb4-10"><a href=""></a><span class="co"># Semilla aleatoria para reproducibilidad</span></span>
<span id="cb4-11"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  </span>
<span id="cb4-12"><a href=""></a>train_ratio <span class="ot">&lt;-</span> <span class="fl">0.8</span></span>
<span id="cb4-13"><a href=""></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb4-14"><a href=""></a>train_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_len</span>(n), <span class="at">size =</span> <span class="fu">floor</span>(train_ratio <span class="sc">*</span> n))</span>
<span id="cb4-15"><a href=""></a>train <span class="ot">&lt;-</span> data[train_indices, ]</span>
<span id="cb4-16"><a href=""></a>test <span class="ot">&lt;-</span> data[<span class="sc">-</span>train_indices, ]</span>
<span id="cb4-17"><a href=""></a></span>
<span id="cb4-18"><a href=""></a><span class="co"># Definimos respuesta y matriz de predictores</span></span>
<span id="cb4-19"><a href=""></a>X_train <span class="ot">=</span> train<span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>price) <span class="sc">|&gt;</span> <span class="fu">as.matrix</span>()</span>
<span id="cb4-20"><a href=""></a>y_train<span class="ot">=</span> <span class="fu">log</span>(train<span class="sc">$</span>price)</span>
<span id="cb4-21"><a href=""></a>X_test <span class="ot">=</span> test<span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>price) <span class="sc">|&gt;</span> <span class="fu">as.matrix</span>()</span>
<span id="cb4-22"><a href=""></a>y_test<span class="ot">=</span> <span class="fu">log</span>(test<span class="sc">$</span>price)</span>
<span id="cb4-23"><a href=""></a></span>
<span id="cb4-24"><a href=""></a><span class="co"># Ajustamos un modelo lasso (alpha=1)</span></span>
<span id="cb4-25"><a href=""></a>fit_lasso <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(X_train, y_train, <span class="at">family =</span> <span class="st">"gaussian"</span>,<span class="at">alpha=</span><span class="dv">1</span>)</span>
<span id="cb4-26"><a href=""></a><span class="co"># Se observa inestabilidad de los predictores conforme algunos se anulan</span></span>
<span id="cb4-27"><a href=""></a><span class="co"># (colinealidad)</span></span>
<span id="cb4-28"><a href=""></a><span class="fu">plot</span>(fit_lasso,<span class="at">xvar=</span><span class="st">'lambda'</span>)</span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img data-src="economl_proyector_files/figure-revealjs/unnamed-chunk-6-7.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Código</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href=""></a><span class="co"># Elegimos el valor óptimo de lambda CV (glmnet incorpora la estimación)</span></span>
<span id="cb5-2"><a href=""></a>fit_lasso_cv <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(X_train, y_train, <span class="at">family =</span> <span class="st">"gaussian"</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">nfolds =</span> <span class="dv">5</span>)</span>
<span id="cb5-3"><a href=""></a><span class="co"># plot(fit_lasso_cv)</span></span>
<span id="cb5-4"><a href=""></a>fit_lasso_cv<span class="sc">$</span>lambda.min</span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 0.002841504</code></pre>
</div>
</div>
</div>
<div id="tabset-2-2">
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Código</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href=""></a><span class="co"># Modelo Ridge</span></span>
<span id="cb7-2"><a href=""></a>fit_ridge<span class="ot">&lt;-</span> <span class="fu">glmnet</span>(X_train, y_train, <span class="at">family =</span> <span class="st">"gaussian"</span>, <span class="at">alpha =</span> <span class="dv">0</span>)</span>
<span id="cb7-3"><a href=""></a><span class="fu">plot</span>(fit_ridge,<span class="at">xvar=</span><span class="st">'lambda'</span>)</span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img data-src="economl_proyector_files/figure-revealjs/unnamed-chunk-7-1.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Código</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href=""></a><span class="co"># Mejor lambda</span></span>
<span id="cb8-2"><a href=""></a>fit_ridge_cv <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(X_train, y_train, <span class="at">family =</span> <span class="st">"gaussian"</span>, <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">nfolds =</span> <span class="dv">5</span>)</span>
<span id="cb8-3"><a href=""></a>fit_ridge_cv<span class="sc">$</span>lambda.min</span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0393516</code></pre>
</div>
</div>
</div>
<div id="tabset-2-3">
<div class="cell">
<details class="code-fold"><summary>Código</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href=""></a><span class="co"># EVALUACION: métrica de bondad de ajuste dentro/fuera muestra</span></span>
<span id="cb10-2"><a href=""></a><span class="co"># Benchmark: modelo lineal </span></span>
<span id="cb10-3"><a href=""></a><span class="co"># (devuelve warning por problema de colinealidad perfecta por categorias no presentes en datos de entrenamiento)</span></span>
<span id="cb10-4"><a href=""></a>fit_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(price)<span class="sc">~</span>., <span class="at">data=</span>train)</span>
<span id="cb10-5"><a href=""></a>r2_lm_train <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="fu">predict</span>(fit_lm), y_train)</span>
<span id="cb10-6"><a href=""></a>r2_lm_test <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="fu">predict</span>(fit_lm,<span class="at">newdata=</span><span class="fu">as.data.frame</span>(X_test)), y_test)</span>
<span id="cb10-7"><a href=""></a></span>
<span id="cb10-8"><a href=""></a><span class="co"># Modelo LASSO</span></span>
<span id="cb10-9"><a href=""></a>r2_lasso_train <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="fu">predict</span>(fit_lasso_cv,<span class="at">newx =</span> X_train), y_train)</span>
<span id="cb10-10"><a href=""></a>r2_lasso_test <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="fu">predict</span>(fit_lasso_cv, <span class="at">newx =</span> X_test), y_test)</span>
<span id="cb10-11"><a href=""></a></span>
<span id="cb10-12"><a href=""></a><span class="co"># Modelo Ridge</span></span>
<span id="cb10-13"><a href=""></a>r2_ridge_train <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="fu">predict</span>(fit_ridge_cv,<span class="at">newx =</span> X_train), y_train)</span>
<span id="cb10-14"><a href=""></a>r2_ridge_test <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="fu">predict</span>(fit_ridge_cv, <span class="at">newx =</span> X_test), y_test)</span>
<span id="cb10-15"><a href=""></a></span>
<span id="cb10-16"><a href=""></a><span class="co"># Crear tabla de resultados</span></span>
<span id="cb10-17"><a href=""></a>lm_resultados <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb10-18"><a href=""></a>  <span class="at">Modelo =</span> <span class="fu">c</span>(<span class="st">"Lineal"</span>, <span class="st">"Lasso"</span>, <span class="st">"Ridge"</span>),</span>
<span id="cb10-19"><a href=""></a>  <span class="at">R2_train=</span><span class="fu">c</span>(r2_lm_train, r2_lasso_train, r2_ridge_train),</span>
<span id="cb10-20"><a href=""></a>  <span class="at">R2_test =</span> <span class="fu">c</span>(r2_lm_test, r2_lasso_test, r2_ridge_test))</span>
<span id="cb10-21"><a href=""></a></span>
<span id="cb10-22"><a href=""></a>lm_resultados <span class="sc">|&gt;</span> kableExtra<span class="sc">::</span><span class="fu">kbl</span>()</span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<table class="caption-top">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Modelo</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">R2_train</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">R2_test</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Lineal</td>
<td style="text-align: right;">0.5752052</td>
<td style="text-align: right;">0.6057520</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lasso</td>
<td style="text-align: right;">0.5156971</td>
<td style="text-align: right;">0.5705224</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ridge</td>
<td style="text-align: right;">0.5628130</td>
<td style="text-align: right;">0.6005851</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</section><section id="árboles-de-decisión" class="slide level2" style="color:#115a72"><h2>Árboles de decisión</h2>
<p>&nbsp;</p>
<ul>
<li><p>Segmenta el espacio de predictores en regiones disjuntas mediante particiones sucesivas: devuelve predicciones locales (media o clase más frecuente de la respuesta en cada región).</p></li>
<li>
<p>Crecimiento de un árbol de decisión</p>
<ul>
<li>Árbol trivial (un nodo)</li>
<li>División binaria recursiva: elección de variable <span class="math inline">\(j\)</span> y punto de corte <span class="math inline">\(s\)</span> que minimiza el ECM de la respuesta tras la partición.<br>
</li>
<li>Repite el proceso hasta criterio de parada (profundidad máxima, hojas con número mínimo de observaciones…).</li>
</ul>
</li>
</ul>
<p>(+) Captura relaciones no lineales e interacciones de forma automática y es fácil de interpretar como un conjunto de reglas.</p>
<p>(-) Tendencia al sobreajuste (si árbol es profundo).</p>
</section><section id="ejemplo-árboles-de-decisión" class="slide level2" style="color:#115a72"><h2>Ejemplo: árboles de decisión</h2>
<p>&nbsp;</p>
<div class="panel-tabset">
<ul id="tabset-3" class="panel-tabset-tabby">
<li><a data-tabby-default="" href="#tabset-3-1">Poco profundo</a></li>
<li><a href="#tabset-3-2">Sin restricción</a></li>
<li><a href="#tabset-3-3">Post-poda</a></li>
<li><a href="#tabset-3-4">Pre-poda</a></li>
<li><a href="#tabset-3-5">Resultados</a></li>
</ul>
<div class="tab-content">
<div id="tabset-3-1">
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Código</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href=""></a><span class="fu">library</span>(rpart)</span>
<span id="cb11-2"><a href=""></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb11-3"><a href=""></a><span class="fu">library</span>(dplyr)</span>
<span id="cb11-4"><a href=""></a><span class="fu">library</span>(caret)</span>
<span id="cb11-5"><a href=""></a></span>
<span id="cb11-6"><a href=""></a><span class="co"># Ajuste de un árbol poco profundo</span></span>
<span id="cb11-7"><a href=""></a>fit_trees <span class="ot">&lt;-</span> <span class="fu">rpart</span>(<span class="fu">log</span>(price)<span class="sc">~</span>., train, <span class="at">maxdepth =</span> <span class="dv">2</span>, <span class="at">cp=</span><span class="dv">0</span>)</span>
<span id="cb11-8"><a href=""></a><span class="fu">rpart.plot</span>(fit_trees, <span class="at">leaf.round =</span> <span class="dv">1</span>, </span>
<span id="cb11-9"><a href=""></a>           <span class="at">space =</span> <span class="dv">2</span>, <span class="at">yspace =</span> <span class="dv">2</span>, </span>
<span id="cb11-10"><a href=""></a>           <span class="at">split.space =</span> <span class="dv">2</span>, </span>
<span id="cb11-11"><a href=""></a>           <span class="at">shadow.col =</span> <span class="st">"gray"</span>, </span>
<span id="cb11-12"><a href=""></a>           <span class="at">trace =</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>box.palette (not diverging): #F7FBFF (near ghostwhite) to #6BAED6 (near skyblue3)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>cex 1   xlim c(0, 1)   ylim c(-0.1, 1.1)</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img data-src="economl_proyector_files/figure-revealjs/unnamed-chunk-9-1.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-2">
<div class="cell">
<details class="code-fold"><summary>Código</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href=""></a>fit_unc <span class="ot">&lt;-</span> <span class="fu">rpart</span>(<span class="fu">log</span>(price)<span class="sc">~</span>., train, <span class="at">minsplit=</span><span class="dv">2</span>, <span class="at">minbucket=</span><span class="dv">1</span>,<span class="at">cp=</span><span class="dv">0</span>)</span>
<span id="cb14-2"><a href=""></a></span>
<span id="cb14-3"><a href=""></a><span class="co"># En este caso se produce un sobreajuste (hemos ajustado ruido de la muestra de entrenamiento)</span></span>
<span id="cb14-4"><a href=""></a>r2_unc_train <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="fu">predict</span>(fit_unc),<span class="fu">log</span>(y_train))</span>
<span id="cb14-5"><a href=""></a>r2_unc_test <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="fu">predict</span>(fit_unc,<span class="at">newdata=</span>test),<span class="fu">log</span>(y_test))</span>
<span id="cb14-6"><a href=""></a></span>
<span id="cb14-7"><a href=""></a><span class="fu">plot</span>(fit_unc)</span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure><p><img data-src="economl_proyector_files/figure-revealjs/unnamed-chunk-10-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-3">
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Código</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href=""></a><span class="co"># El árbol sin restricción estimado incluye tabla cptable que recoge para distintos valores de cp (parámetro de complejidad)</span></span>
<span id="cb15-2"><a href=""></a><span class="co"># Elegimos mejor por error de CV</span></span>
<span id="cb15-3"><a href=""></a>bestcp <span class="ot">&lt;-</span> fit_unc<span class="sc">$</span>cptable[<span class="fu">which.min</span>(fit_unc<span class="sc">$</span>cptable[, <span class="st">"xerror"</span>]), <span class="st">"CP"</span>]</span>
<span id="cb15-4"><a href=""></a><span class="co"># Poda del árbol basada en el parámetro cp</span></span>
<span id="cb15-5"><a href=""></a>fit_post <span class="ot">&lt;-</span> <span class="fu">prune</span>(fit_unc, <span class="at">cp =</span> bestcp)</span>
<span id="cb15-6"><a href=""></a></span>
<span id="cb15-7"><a href=""></a><span class="co"># métricas</span></span>
<span id="cb15-8"><a href=""></a>r2_post_train <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="fu">predict</span>(fit_post),<span class="fu">log</span>(y_train))</span>
<span id="cb15-9"><a href=""></a>r2_post_test <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="fu">predict</span>(fit_post,<span class="at">newdata=</span>test),<span class="fu">log</span>(y_test))</span>
<span id="cb15-10"><a href=""></a></span>
<span id="cb15-11"><a href=""></a></span>
<span id="cb15-12"><a href=""></a><span class="co"># Visualización del error de validación cruzada en función del parámetro de complejidad</span></span>
<span id="cb15-13"><a href=""></a><span class="fu">plotcp</span>(fit_unc,<span class="at">col=</span><span class="dv">2</span>)</span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img data-src="economl_proyector_files/figure-revealjs/unnamed-chunk-11-1.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-3-4">
<div class="cell">
<details class="code-fold"><summary>Código</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href=""></a><span class="fu">library</span>(caret)</span>
<span id="cb16-2"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb16-3"><a href=""></a></span>
<span id="cb16-4"><a href=""></a><span class="co"># Como se controla el proceso de entrenamiento: cv con 5 particiones</span></span>
<span id="cb16-5"><a href=""></a>ctrl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(<span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">5</span>)</span>
<span id="cb16-6"><a href=""></a></span>
<span id="cb16-7"><a href=""></a><span class="co"># Secuencia de profundidades a evaluar</span></span>
<span id="cb16-8"><a href=""></a>grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">maxdepth =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">30</span>)</span>
<span id="cb16-9"><a href=""></a></span>
<span id="cb16-10"><a href=""></a><span class="co"># Entrenamos el modelo</span></span>
<span id="cb16-11"><a href=""></a>modelo_pre <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb16-12"><a href=""></a>  <span class="fu">log</span>(price)<span class="sc">~</span>.,</span>
<span id="cb16-13"><a href=""></a>  <span class="at">data=</span> train, </span>
<span id="cb16-14"><a href=""></a>  <span class="at">method =</span> <span class="st">"rpart2"</span>,           </span>
<span id="cb16-15"><a href=""></a>  <span class="at">trControl =</span> ctrl,</span>
<span id="cb16-16"><a href=""></a>  <span class="at">tuneGrid =</span> grid,</span>
<span id="cb16-17"><a href=""></a>  <span class="at">control =</span> <span class="fu">rpart.control</span>(<span class="at">cp =</span> <span class="dv">0</span>) </span>
<span id="cb16-18"><a href=""></a>)</span>
<span id="cb16-19"><a href=""></a></span>
<span id="cb16-20"><a href=""></a><span class="co"># Visualizamos error CV vs. depth</span></span>
<span id="cb16-21"><a href=""></a></span>
<span id="cb16-22"><a href=""></a><span class="fu">plot</span>(modelo_pre)</span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure><p><img data-src="economl_proyector_files/figure-revealjs/unnamed-chunk-12-1.png" width="960"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>Código</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href=""></a><span class="co"># Resultados de CV (la media de la métrica pero también SD, para ver si inestabilidad)</span></span>
<span id="cb17-2"><a href=""></a><span class="co"># modelo_pre$results</span></span>
<span id="cb17-3"><a href=""></a><span class="co"># Mejor modelo</span></span>
<span id="cb17-4"><a href=""></a><span class="co"># modelo_pre$bestTune</span></span>
<span id="cb17-5"><a href=""></a><span class="co"># Elegimos modelo final CV</span></span>
<span id="cb17-6"><a href=""></a>fit_pre <span class="ot">&lt;-</span> modelo_pre<span class="sc">$</span>finalModel</span>
<span id="cb17-7"><a href=""></a>r2_pre_train <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="fu">predict</span>(fit_pre),<span class="fu">log</span>(y_train)) </span>
<span id="cb17-8"><a href=""></a>r2_pre_test <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="fu">predict</span>(fit_pre,<span class="at">newdata=</span>test),<span class="fu">log</span>(y_test))</span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</div>
<div id="tabset-3-5">
<div class="cell">
<details class="code-fold"><summary>Código</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href=""></a><span class="co"># Crear tabla de resultados para todos los árboles entrenados</span></span>
<span id="cb18-2"><a href=""></a>resultados <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb18-3"><a href=""></a>  <span class="at">Modelo =</span> <span class="fu">c</span>(<span class="st">"Árbol unc."</span>, <span class="st">"Árbol post"</span>,<span class="st">"Árbol pre"</span>),</span>
<span id="cb18-4"><a href=""></a>  <span class="at">R2_train =</span> <span class="fu">c</span>(r2_unc_train, r2_post_train,r2_pre_train),</span>
<span id="cb18-5"><a href=""></a>  <span class="at">R2_test =</span> <span class="fu">c</span>(r2_unc_test, r2_post_test,r2_pre_test)</span>
<span id="cb18-6"><a href=""></a>)</span>
<span id="cb18-7"><a href=""></a></span>
<span id="cb18-8"><a href=""></a>resultados <span class="sc">|&gt;</span> kableExtra<span class="sc">::</span><span class="fu">kbl</span>()</span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<table class="caption-top">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Modelo</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">R2_train</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">R2_test</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Árbol unc.</td>
<td style="text-align: right;">0.9771030</td>
<td style="text-align: right;">0.4469618</td>
</tr>
<tr class="even">
<td style="text-align: left;">Árbol post</td>
<td style="text-align: right;">0.6463274</td>
<td style="text-align: right;">0.5882114</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Árbol pre</td>
<td style="text-align: right;">0.7917730</td>
<td style="text-align: right;">0.5941620</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</section><section id="modelos-de-ensamblaje" class="slide level2" style="color:#115a72"><h2>Modelos de ensamblaje</h2>
<p>&nbsp;</p>
<p>Un ensamble es un estimador agregado que combina múltiples modelos (o estimadores base) para producir una única predicción más robusta y precisa que la de cualquiera de los modelos individuales que lo componen.</p>
<ul>
<li><p>La agregación (promedio) de modelos funciona al combinar predicciones cuyos errores no están perfectamente correlacionados, lo que permite su cancelación parcial.</p></li>
<li><p>En la práctica, la combinación de modelos con diferentes características de sesgo-varianza persigue minimizar el error de generalización: combinar modelos con alto sesgo reduce el sesgo global (<em>boosting</em>), mientras que combinar modelos con alta varianza reduce la varianza global (<em>bagging</em> o <em>random forests</em>).</p></li>
</ul>
<blockquote>
<p>Los ensambles suelen tener un buen rendimiento predictivo incluso sin un ajuste exhaustivo de hiperparámetros</p>
</blockquote>
</section><section id="bosque-aleatoriorandom-forest" class="slide level2" style="color:#115a72"><h2>Bosque aleatorio/Random forest</h2>
<p>&nbsp;</p>
<ul>
<li>Agregación bootstrap o <strong>bagging</strong>
<ul>
<li>
<span class="math inline">\(B\)</span> muestras <em>bootstrap</em>
</li>
<li>Estimación: <span class="math inline">\(\hat{f}_1, \hat{f}_2 \ldots \hat{f}_B\)</span> (<span class="math inline">\(B\)</span> árboles profundos)</li>
<li>Predicción para <span class="math inline">\(x_i\)</span>: <span class="math inline">\(\hat{f}_{bag}=\frac{1}{B}\sum_b\hat{f}_b(x_i)\)</span>
</li>
<li>
<span class="math inline">\(\hat{f}_{bag}\)</span> tendrá una varianza menor que sus componentes &nbsp;</li>
</ul>
</li>
<li>Un <strong>random forest</strong> incorpora dos fuentes de aleatoriedad para descorrelacionar aún más las predicciones de los estimadores base (árboles):
<ul>
<li>Generación de <span class="math inline">\(B\)</span> muestras bootstrap sobre las que entrenar árboles individuales</li>
<li>Selección aleatoria de <span class="math inline">\(m\)</span> de predictores para cada división de los árboles (<span class="math inline">\(m&lt;p\)</span>, con <span class="math inline">\(p\)</span> número total de predictores)</li>
</ul>
</li>
</ul></section><section id="ejemplo-random-forest" class="slide level2" style="color:#115a72"><h2>Ejemplo: random forest</h2>
<p>&nbsp;</p>
<div class="panel-tabset">
<ul id="tabset-4" class="panel-tabset-tabby">
<li><a data-tabby-default="" href="#tabset-4-1">Ajuste</a></li>
<li><a href="#tabset-4-2">Selección hiperparámetros</a></li>
</ul>
<div class="tab-content">
<div id="tabset-4-1">
<div class="cell">
<details class="code-fold"><summary>Código</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href=""></a><span class="fu">library</span>(randomForest)</span>
<span id="cb19-2"><a href=""></a></span>
<span id="cb19-3"><a href=""></a><span class="co"># Hiperparámetros: </span></span>
<span id="cb19-4"><a href=""></a><span class="co">#   ntrees: número de árboles a estimar (=número de muestras bootstrap)</span></span>
<span id="cb19-5"><a href=""></a><span class="co">#           Aumentar el número de estimadores mejora la calidad predictiva sin  </span></span>
<span id="cb19-6"><a href=""></a><span class="co">#           riesgo de sobreajuste (el error de generalización tiende a </span></span>
<span id="cb19-7"><a href=""></a><span class="co">#           estabilizarse). Elegir valor elevado.</span></span>
<span id="cb19-8"><a href=""></a><span class="co">#   mtry: porcentaje de predictores que se seleccionan aleatoriamente para partición.</span></span>
<span id="cb19-9"><a href=""></a><span class="co">#         Valores más bajos descorrelacionan más los árboles: estos difieren más</span></span>
<span id="cb19-10"><a href=""></a><span class="co">#         al entrenarse sobre conjunto menor y muy probablemente más diferente de</span></span>
<span id="cb19-11"><a href=""></a><span class="co">#         predictores (menor varianza pero mayor sesgo al agregar modelos más </span></span>
<span id="cb19-12"><a href=""></a><span class="co">#         simples). Valores más altos reducen el sesgo pero reducen el beneficio</span></span>
<span id="cb19-13"><a href=""></a><span class="co">#         de la agregación se reduce </span></span>
<span id="cb19-14"><a href=""></a></span>
<span id="cb19-15"><a href=""></a>m <span class="ot">&lt;-</span> <span class="fu">dim</span>(X_train)[<span class="dv">2</span>]<span class="sc">/</span><span class="dv">3</span>                         <span class="co"># Elegimos p/3 predictores en cada partición  </span></span>
<span id="cb19-16"><a href=""></a>fit_rf <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(<span class="fu">log</span>(price)<span class="sc">~</span>.,</span>
<span id="cb19-17"><a href=""></a>                       <span class="at">ntree =</span> <span class="dv">100</span>,            <span class="co"># 500 por defecto</span></span>
<span id="cb19-18"><a href=""></a>                       <span class="at">mtry=</span>m,                  <span class="co"># m=p/3 por defecto</span></span>
<span id="cb19-19"><a href=""></a>                       <span class="at">data =</span> train)           </span>
<span id="cb19-20"><a href=""></a></span>
<span id="cb19-21"><a href=""></a>r2_rf_train <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="fu">predict</span>(fit_rf,X_train),y_train)</span>
<span id="cb19-22"><a href=""></a>r2_rf_test <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="fu">predict</span>(fit_rf,X_test),y_test)</span>
<span id="cb19-23"><a href=""></a></span>
<span id="cb19-24"><a href=""></a><span class="co"># Random forest ajustado</span></span>
<span id="cb19-25"><a href=""></a>fit_rf</span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
 randomForest(formula = log(price) ~ ., data = train, ntree = 100,      mtry = m) 
               Type of random forest: regression
                     Number of trees: 100
No. of variables tried at each split: 51

          Mean of squared residuals: 0.1463327
                    % Var explained: 65.6</code></pre>
</div>
</div>
</div>
<div id="tabset-4-2">
<div class="cell">
<details class="code-fold"><summary>Código</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href=""></a><span class="co"># Proceso lento: doParallel paraleliza</span></span>
<span id="cb21-2"><a href=""></a><span class="fu">library</span>(doParallel)</span>
<span id="cb21-3"><a href=""></a><span class="co"># Detectar núcleos disponibles y usar todos menos uno</span></span>
<span id="cb21-4"><a href=""></a>cl <span class="ot">&lt;-</span> <span class="fu">makeCluster</span>(parallel<span class="sc">::</span><span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb21-5"><a href=""></a><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb21-6"><a href=""></a></span>
<span id="cb21-7"><a href=""></a><span class="co"># Parámetros que controlan el ajuste</span></span>
<span id="cb21-8"><a href=""></a>ctrl <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(</span>
<span id="cb21-9"><a href=""></a>  <span class="at">method =</span> <span class="st">"cv"</span>, <span class="at">number =</span> <span class="dv">5</span>, </span>
<span id="cb21-10"><a href=""></a>  <span class="at">summaryFunction =</span> defaultSummary,  <span class="co"># RMSE, Rsquared, MAE</span></span>
<span id="cb21-11"><a href=""></a>  <span class="at">verboseIter =</span> <span class="cn">TRUE</span>,</span>
<span id="cb21-12"><a href=""></a>  <span class="at">allowParallel =</span> <span class="cn">TRUE</span></span>
<span id="cb21-13"><a href=""></a>)</span>
<span id="cb21-14"><a href=""></a></span>
<span id="cb21-15"><a href=""></a><span class="co"># Grid para mtry</span></span>
<span id="cb21-16"><a href=""></a>p <span class="ot">&lt;-</span> <span class="fu">dim</span>(X_train)[<span class="dv">2</span>]</span>
<span id="cb21-17"><a href=""></a>grid_mtry <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb21-18"><a href=""></a>  <span class="at">mtry =</span> <span class="fu">round</span>(<span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.9</span>,<span class="fl">0.05</span>)<span class="sc">*</span>p))</span>
<span id="cb21-19"><a href=""></a></span>
<span id="cb21-20"><a href=""></a><span class="co"># Muestreo CV</span></span>
<span id="cb21-21"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb21-22"><a href=""></a><span class="co"># Entrenamiento (puede)</span></span>
<span id="cb21-23"><a href=""></a>fit_rf_cv <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb21-24"><a href=""></a>  <span class="fu">log</span>(price) <span class="sc">~</span> .,               </span>
<span id="cb21-25"><a href=""></a>  <span class="at">data =</span> train,</span>
<span id="cb21-26"><a href=""></a>  <span class="at">method =</span> <span class="st">"rf"</span>,           <span class="co"># usa randomForest</span></span>
<span id="cb21-27"><a href=""></a>  <span class="at">trControl =</span> ctrl,</span>
<span id="cb21-28"><a href=""></a>  <span class="at">tuneGrid =</span> grid_mtry,</span>
<span id="cb21-29"><a href=""></a>  <span class="at">ntree =</span> <span class="dv">100</span>,              </span>
<span id="cb21-30"><a href=""></a>  <span class="at">importance =</span> <span class="cn">TRUE</span></span>
<span id="cb21-31"><a href=""></a>)</span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Aggregating results
Selecting tuning parameters
Fitting mtry = 76 on full training set</code></pre>
</div>
<details class="code-fold"><summary>Código</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href=""></a><span class="fu">stopCluster</span>(cl)</span>
<span id="cb23-2"><a href=""></a></span>
<span id="cb23-3"><a href=""></a><span class="co"># Evaluación del modelo</span></span>
<span id="cb23-4"><a href=""></a>r2_rf_cv_train <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="fu">predict</span>(fit_rf_cv,X_train),y_train)</span>
<span id="cb23-5"><a href=""></a>r2_rf_cv_test <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="fu">predict</span>(fit_rf_cv,X_test),y_test)</span>
<span id="cb23-6"><a href=""></a></span>
<span id="cb23-7"><a href=""></a><span class="co"># Visualizamos RMSE cv vs. mtry</span></span>
<span id="cb23-8"><a href=""></a><span class="fu">plot</span>(fit_rf_cv)</span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure><p><img data-src="economl_proyector_files/figure-revealjs/unnamed-chunk-15-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="boosting" class="slide level2" style="color:#115a72"><h2>Boosting</h2>
<p>&nbsp;</p>
<p>Combinación de estimadores débiles (elevado sesgo, p.e., árboles de poca profundidad) para crear un modelo más robusto y preciso.</p>
<ul>
<li>Aprendizaje secuencial:
<ul>
<li>Cada árbol se construye usando información de los árboles de iteraciones anteriores (i.e., sobre una versión modificada de los datos originales)</li>
<li>En ese proceso secuencial, cada modelo se centra en corregir los errores de predicción de la etapa anterior.</li>
<li>El proceso iterativo aumenta gradualmente la calidad de las predicciones (reduciendo el sesgo del modelo resultante). Cada nuevo estimador mejora (potencia) el rendimiento del anterior.</li>
</ul>
</li>
</ul></section><section id="gradient-boosting-machine-gbm" class="slide level2" style="color:#115a72"><h2>Gradient Boosting Machine (GBM)</h2>
<p>&nbsp;</p>
<p>GBM introduce optimización basada en gradiente donde cada nuevo modelo se ajusta en la dirección de máximo descenso de la función de pérdida.</p>
<p>Dados:<br>
- Las iteraciones o etapas boosting <span class="math inline">\(t\in \{0,1,2,\ldots T\}\)</span><br>
- <span class="math inline">\(h_t\)</span> es el modelo añadido en la iteración <span class="math inline">\(t\)</span>, ajustado para aproximar el gradiente (o pseudo-residuo) de la función de pérdida respecto a las predicciones del modelo anterior.<br>
- <span class="math inline">\(F_{t-1}\)</span> o la predicción agregada en <span class="math inline">\(t-1\)</span><br>
- La tasa de aprendizaje (o <em>shrinkage</em>) <span class="math inline">\(\eta \in (0,1)\)</span> que amortigua la contribución de cada modelo al ensamble.</p>
<p>La actualización de la predicción en <span class="math inline">\(t\)</span> para <span class="math inline">\(x\)</span> es <span class="math display">\[F_t(x)=F_{t-1}(x)+\eta \, h_t(x)\]</span>.</p>
</section><section id="métodos-boosting" class="slide level2" style="color:#115a72"><h2>Métodos Boosting</h2>
<p>&nbsp;</p>
<table class="caption-top">
<colgroup>
<col style="width: 33%">
<col style="width: 20%">
<col style="width: 45%">
</colgroup>
<thead><tr class="header">
<th>Generación</th>
<th>Modelos</th>
<th>Rasgo clave</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Boosting clásico</td>
<td><code>AdaBoost</code></td>
<td>Repondera muestras por error</td>
</tr>
<tr class="even">
<td>Gradient boosting</td>
<td><code>GBM</code></td>
<td>Descenso del gradiente funcional</td>
</tr>
<tr class="odd">
<td>Extreme gradient boosting (boosting optimizado)</td>
<td><code>XGBoost</code></td>
<td>Grad + Hess, regularización explícita</td>
</tr>
<tr class="even">
<td>Boosting basado en histograma</td>
<td>
<code>LightGBM</code>, <code>HistGBM</code>
</td>
<td>Histogramas, velocidad, escalabilidad</td>
</tr>
</tbody>
</table></section><section id="ejemplo-extreme-gradient-boosting" class="slide level2" style="color:#115a72"><h2>Ejemplo: extreme gradient boosting</h2>
<p>&nbsp;</p>
<div class="panel-tabset">
<ul id="tabset-5" class="panel-tabset-tabby">
<li><a data-tabby-default="" href="#tabset-5-1"><code>xgboost</code></a></li>
<li><a href="#tabset-5-2"><code>xgboost</code></a></li>
<li><a href="#tabset-5-3"><code>xgboost</code> + cv</a></li>
</ul>
<div class="tab-content">
<div id="tabset-5-1">
<div class="cell">
<details class="code-fold"><summary>Código</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href=""></a><span class="fu">library</span>(xgboost)</span>
<span id="cb24-2"><a href=""></a></span>
<span id="cb24-3"><a href=""></a><span class="co"># DMatrix (mejor gestión de datos en memoria)</span></span>
<span id="cb24-4"><a href=""></a>dtrain <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> X_train, <span class="at">label =</span> y_train)</span>
<span id="cb24-5"><a href=""></a>dtest  <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> X_test,  <span class="at">label =</span> y_test)</span>
<span id="cb24-6"><a href=""></a></span>
<span id="cb24-7"><a href=""></a><span class="co"># Parámetros básicos para regresión</span></span>
<span id="cb24-8"><a href=""></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb24-9"><a href=""></a>  <span class="at">eta =</span> <span class="fl">0.005</span>,          <span class="co"># learning rate (pequeño; candidato a ajuste por cv)</span></span>
<span id="cb24-10"><a href=""></a>  <span class="at">max_depth =</span> <span class="dv">6</span>,        <span class="co"># profundidad máxima árboles</span></span>
<span id="cb24-11"><a href=""></a>  <span class="at">min_child_weight =</span> <span class="dv">1</span>, <span class="co"># número de instancias en nodo terminal</span></span>
<span id="cb24-12"><a href=""></a>  <span class="at">subsample =</span> <span class="fl">0.8</span>,      <span class="co"># muestreo (% de obs) para generar arboles. Evita sobreajuste</span></span>
<span id="cb24-13"><a href=""></a>  <span class="at">colsample_bytree =</span> <span class="fl">0.8</span>, <span class="co"># muestreo sobre predictores por arbol</span></span>
<span id="cb24-14"><a href=""></a>  <span class="at">lambda =</span> <span class="dv">1</span>,           <span class="co"># regularización L2</span></span>
<span id="cb24-15"><a href=""></a>  <span class="at">alpha =</span> <span class="dv">0</span>             <span class="co"># regularización L1</span></span>
<span id="cb24-16"><a href=""></a>)</span>
<span id="cb24-17"><a href=""></a></span>
<span id="cb24-18"><a href=""></a><span class="co"># Early stopping: parar proceso si en la secuencia de árboles</span></span>
<span id="cb24-19"><a href=""></a><span class="co"># entrenados tras t iteraciones no se producen mejoras en la calidad</span></span>
<span id="cb24-20"><a href=""></a><span class="co"># del estimador en un conjunto de prueba. Previene overfitting y</span></span>
<span id="cb24-21"><a href=""></a><span class="co"># evita tiempo de procesamiento innecesario.</span></span>
<span id="cb24-22"><a href=""></a><span class="co"># Pasamos a watch el conjunto de prueba</span></span>
<span id="cb24-23"><a href=""></a></span>
<span id="cb24-24"><a href=""></a>watch <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">train =</span> dtrain, <span class="at">eval =</span> dtest)</span>
<span id="cb24-25"><a href=""></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb24-26"><a href=""></a><span class="co"># Entrenamos</span></span>
<span id="cb24-27"><a href=""></a>fit_xgb <span class="ot">&lt;-</span> <span class="fu">xgb.train</span>(</span>
<span id="cb24-28"><a href=""></a>  <span class="at">params =</span> params,</span>
<span id="cb24-29"><a href=""></a>  <span class="at">data =</span> dtrain,</span>
<span id="cb24-30"><a href=""></a>  <span class="at">nrounds =</span> <span class="dv">5000</span>,           <span class="co"># número máximo de árboles. Fijar número elevado</span></span>
<span id="cb24-31"><a href=""></a>  <span class="at">watchlist =</span> watch,</span>
<span id="cb24-32"><a href=""></a>  <span class="at">early_stopping_rounds =</span> <span class="dv">50</span>, <span class="co"># rondas para stop si no mejora rmse en eval</span></span>
<span id="cb24-33"><a href=""></a>  <span class="at">print_every_n =</span> <span class="dv">50</span></span>
<span id="cb24-34"><a href=""></a>)</span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] train-rmse:4.136281 eval-rmse:4.109068 
Multiple eval metrics are present. Will use eval_rmse for early stopping.
Will train until eval_rmse hasn't improved in 50 rounds.

[51]    train-rmse:3.233787 eval-rmse:3.210153 
[101]   train-rmse:2.533591 eval-rmse:2.513439 
[151]   train-rmse:1.990984 eval-rmse:1.973705 
[201]   train-rmse:1.571511 eval-rmse:1.557950 
[251]   train-rmse:1.248043 eval-rmse:1.238708 
[301]   train-rmse:1.000434 eval-rmse:0.996108 
[351]   train-rmse:0.811708 eval-rmse:0.812806 
[401]   train-rmse:0.669494 eval-rmse:0.677694 
[451]   train-rmse:0.563671 eval-rmse:0.579930 
[501]   train-rmse:0.485961 eval-rmse:0.510727 
[551]   train-rmse:0.429458 eval-rmse:0.463358 
[601]   train-rmse:0.389097 eval-rmse:0.431461 
[651]   train-rmse:0.360169 eval-rmse:0.410701 
[701]   train-rmse:0.339327 eval-rmse:0.396956 
[751]   train-rmse:0.324553 eval-rmse:0.388186 
[801]   train-rmse:0.313427 eval-rmse:0.382327 
[851]   train-rmse:0.304825 eval-rmse:0.378221 
[901]   train-rmse:0.298147 eval-rmse:0.375744 
[951]   train-rmse:0.292797 eval-rmse:0.373887 
[1001]  train-rmse:0.288654 eval-rmse:0.372706 
[1051]  train-rmse:0.284746 eval-rmse:0.371552 
[1101]  train-rmse:0.281553 eval-rmse:0.370785 
[1151]  train-rmse:0.278501 eval-rmse:0.370071 
[1201]  train-rmse:0.275585 eval-rmse:0.369529 
[1251]  train-rmse:0.272962 eval-rmse:0.368852 
[1301]  train-rmse:0.270543 eval-rmse:0.368513 
[1351]  train-rmse:0.268143 eval-rmse:0.367996 
[1401]  train-rmse:0.265586 eval-rmse:0.367557 
[1451]  train-rmse:0.263329 eval-rmse:0.367231 
[1501]  train-rmse:0.260996 eval-rmse:0.366940 
[1551]  train-rmse:0.258824 eval-rmse:0.366615 
[1601]  train-rmse:0.256693 eval-rmse:0.366408 
[1651]  train-rmse:0.254420 eval-rmse:0.366134 
[1701]  train-rmse:0.252348 eval-rmse:0.365788 
[1751]  train-rmse:0.250173 eval-rmse:0.365434 
[1801]  train-rmse:0.247897 eval-rmse:0.365261 
[1851]  train-rmse:0.245816 eval-rmse:0.365132 
[1901]  train-rmse:0.243895 eval-rmse:0.365037 
[1951]  train-rmse:0.242319 eval-rmse:0.364916 
[2001]  train-rmse:0.240409 eval-rmse:0.364747 
[2051]  train-rmse:0.238539 eval-rmse:0.364638 
[2101]  train-rmse:0.236655 eval-rmse:0.364367 
[2151]  train-rmse:0.234803 eval-rmse:0.364240 
[2201]  train-rmse:0.232844 eval-rmse:0.364047 
[2251]  train-rmse:0.231095 eval-rmse:0.363886 
[2301]  train-rmse:0.229376 eval-rmse:0.363783 
[2351]  train-rmse:0.227633 eval-rmse:0.363746 
[2401]  train-rmse:0.225905 eval-rmse:0.363683 
[2451]  train-rmse:0.224284 eval-rmse:0.363560 
[2501]  train-rmse:0.222561 eval-rmse:0.363497 
[2551]  train-rmse:0.220956 eval-rmse:0.363426 
[2601]  train-rmse:0.219268 eval-rmse:0.363377 
[2651]  train-rmse:0.217782 eval-rmse:0.363272 
[2701]  train-rmse:0.215988 eval-rmse:0.363232 
[2751]  train-rmse:0.214599 eval-rmse:0.363141 
[2801]  train-rmse:0.213012 eval-rmse:0.362932 
[2851]  train-rmse:0.211401 eval-rmse:0.362880 
Stopping. Best iteration:
[2819]  train-rmse:0.212408 eval-rmse:0.362853</code></pre>
</div>
<details class="code-fold"><summary>Código</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href=""></a><span class="co"># Resultados: mejor iteración y RMSE</span></span>
<span id="cb26-2"><a href=""></a><span class="co"># fit_xgb$best_iteration</span></span>
<span id="cb26-3"><a href=""></a><span class="co"># fit_xgb$best_score</span></span>
<span id="cb26-4"><a href=""></a></span>
<span id="cb26-5"><a href=""></a><span class="co"># Predicción y métricas</span></span>
<span id="cb26-6"><a href=""></a>r2_xgb_train <span class="ot">&lt;-</span><span class="fu">R2</span>(<span class="fu">predict</span>(fit_xgb, dtrain),y_train)</span>
<span id="cb26-7"><a href=""></a>r2_xgb_test <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="fu">predict</span>(fit_xgb, dtest),y_test)</span>
<span id="cb26-8"><a href=""></a></span>
<span id="cb26-9"><a href=""></a><span class="co"># objeto resultante</span></span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</div>
<div id="tabset-5-2">
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Código</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href=""></a><span class="co"># Visualización proceso iterativo</span></span>
<span id="cb27-2"><a href=""></a></span>
<span id="cb27-3"><a href=""></a>fit_xgb<span class="sc">$</span>evaluation_log <span class="sc">|&gt;</span> <span class="fu">ggplot</span>() <span class="sc">+</span>  </span>
<span id="cb27-4"><a href=""></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>iter,<span class="at">y=</span>train_rmse), <span class="at">alpha=</span><span class="fl">0.15</span>, <span class="at">color=</span><span class="st">'salmon'</span>) <span class="sc">+</span></span>
<span id="cb27-5"><a href=""></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>iter,<span class="at">y=</span>eval_rmse), <span class="at">alpha=</span><span class="fl">0.15</span>,<span class="at">color=</span><span class="st">'navy'</span>) <span class="sc">+</span> </span>
<span id="cb27-6"><a href=""></a>  <span class="fu">xlab</span>(<span class="st">'Iteración'</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">'rmse train/rmse eval'</span>) <span class="sc">+</span>    </span>
<span id="cb27-7"><a href=""></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2351</span>, <span class="at">color =</span> <span class="st">"brown"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb27-8"><a href=""></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>,<span class="at">label=</span><span class="fu">paste0</span>(<span class="st">'n_trees = '</span>,fit_xgb<span class="sc">$</span>best_iteration), </span>
<span id="cb27-9"><a href=""></a>           <span class="at">x =</span> fit_xgb<span class="sc">$</span>best_iteration, <span class="at">y=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb27-10"><a href=""></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb27-11"><a href=""></a>  <span class="fu">scale_y_log10</span>()  </span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img data-src="economl_proyector_files/figure-revealjs/unnamed-chunk-17-1.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-5-3">
<div class="cell">
<details class="code-fold"><summary>Código</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href=""></a><span class="co"># Warning: ejecución larga</span></span>
<span id="cb28-2"><a href=""></a>etas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.0025</span>,<span class="fl">0.005</span>, <span class="fl">0.01</span>,<span class="fl">0.05</span>, <span class="fl">0.1</span>)</span>
<span id="cb28-3"><a href=""></a><span class="co"># Aquí usa watchlist interno (el fold de validación)</span></span>
<span id="cb28-4"><a href=""></a>results <span class="ot">&lt;-</span> <span class="fu">lapply</span>(etas, <span class="cf">function</span>(e) {</span>
<span id="cb28-5"><a href=""></a>  params<span class="sc">$</span>eta <span class="ot">&lt;-</span> e</span>
<span id="cb28-6"><a href=""></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb28-7"><a href=""></a>  cv <span class="ot">&lt;-</span> <span class="fu">xgb.cv</span>(</span>
<span id="cb28-8"><a href=""></a>    <span class="at">params =</span> params,</span>
<span id="cb28-9"><a href=""></a>    <span class="at">data =</span> dtrain,</span>
<span id="cb28-10"><a href=""></a>    <span class="at">nrounds =</span> <span class="dv">10000</span>, <span class="co"># dejamos un número elevado de iter (al fijar etas bajos) </span></span>
<span id="cb28-11"><a href=""></a>    <span class="at">nfold =</span> <span class="dv">5</span>,</span>
<span id="cb28-12"><a href=""></a>    <span class="at">early_stopping_rounds =</span> <span class="dv">50</span>,</span>
<span id="cb28-13"><a href=""></a>    <span class="at">metrics =</span> <span class="st">"rmse"</span>,</span>
<span id="cb28-14"><a href=""></a>    <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb28-15"><a href=""></a>  )</span>
<span id="cb28-16"><a href=""></a>  </span>
<span id="cb28-17"><a href=""></a>  <span class="fu">tibble</span>(<span class="at">eta =</span> e, </span>
<span id="cb28-18"><a href=""></a>         <span class="at">best_rmse =</span> <span class="fu">min</span>(cv<span class="sc">$</span>evaluation_log<span class="sc">$</span>test_rmse_mean),</span>
<span id="cb28-19"><a href=""></a>         <span class="at">best_iter =</span> cv<span class="sc">$</span>best_iteration)</span>
<span id="cb28-20"><a href=""></a>})</span>
<span id="cb28-21"><a href=""></a></span>
<span id="cb28-22"><a href=""></a>tabla <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(results)</span>
<span id="cb28-23"><a href=""></a></span>
<span id="cb28-24"><a href=""></a><span class="co"># Entrenamos modelo con mejor eta</span></span>
<span id="cb28-25"><a href=""></a>best_eta <span class="ot">&lt;-</span> tabla <span class="sc">%&gt;%</span> <span class="fu">slice_min</span>(best_rmse) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(eta)</span>
<span id="cb28-26"><a href=""></a>params<span class="sc">$</span>eta <span class="ot">&lt;-</span> best_eta</span>
<span id="cb28-27"><a href=""></a>best_iter <span class="ot">&lt;-</span> tabla <span class="sc">%&gt;%</span> <span class="fu">slice_min</span>(best_rmse) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(best_iter)</span>
<span id="cb28-28"><a href=""></a></span>
<span id="cb28-29"><a href=""></a>fit_xgb_cv <span class="ot">&lt;-</span> <span class="fu">xgb.train</span>(</span>
<span id="cb28-30"><a href=""></a>  <span class="at">params =</span> params,</span>
<span id="cb28-31"><a href=""></a>  <span class="at">data =</span> dtrain,</span>
<span id="cb28-32"><a href=""></a>  <span class="at">nrounds =</span> best_iter</span>
<span id="cb28-33"><a href=""></a>)</span>
<span id="cb28-34"><a href=""></a></span>
<span id="cb28-35"><a href=""></a>r2_xgb_cv_train <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="fu">predict</span>(fit_xgb_cv,dtrain),y_train)</span>
<span id="cb28-36"><a href=""></a>r2_xgb_cv_test <span class="ot">&lt;-</span> <span class="fu">R2</span>(<span class="fu">predict</span>(fit_xgb_cv,dtest),y_test)</span>
<span id="cb28-37"><a href=""></a></span>
<span id="cb28-38"><a href=""></a><span class="co"># Gráfica de rmse vs eta (+ número de iteraciones)</span></span>
<span id="cb28-39"><a href=""></a></span>
<span id="cb28-40"><a href=""></a><span class="fu">ggplot</span>(tabla, <span class="fu">aes</span>(<span class="at">x =</span> eta, <span class="at">y =</span> best_rmse)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color=</span><span class="st">'navy'</span>) <span class="sc">+</span></span>
<span id="cb28-41"><a href=""></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> best_iter, <span class="at">color =</span> best_iter)) <span class="sc">+</span> </span>
<span id="cb28-42"><a href=""></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb28-43"><a href=""></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"eta"</span>, <span class="at">y =</span> <span class="st">"RMSE"</span>, <span class="at">size =</span> <span class="st">"Iteraciones"</span>, <span class="at">color =</span> <span class="st">"Iteraciones"</span>,</span>
<span id="cb28-44"><a href=""></a>       <span class="at">title =</span> <span class="st">"Trade-off: RMSE vs eta según iteraciones"</span>) <span class="sc">+</span> </span>
<span id="cb28-45"><a href=""></a>  <span class="fu">annotate</span>(<span class="st">'text'</span>,<span class="at">x=</span>tabla<span class="sc">$</span>eta,<span class="at">y=</span>tabla<span class="sc">$</span>best_rmse<span class="fl">+0.0002</span>,<span class="at">label=</span>tabla<span class="sc">$</span>best_iter) <span class="sc">+</span></span>
<span id="cb28-46"><a href=""></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb28-47"><a href=""></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure><p><img data-src="economl_proyector_files/figure-revealjs/unnamed-chunk-18-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section id="resumen-modelos" class="slide level2" style="color:#115a72"><h2>Resumen modelos</h2>
<p>&nbsp;</p>
<div class="cell">
<details class="code-fold"><summary>Código</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href=""></a>Modelo <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"LM"</span>,<span class="st">"Lasso"</span>,<span class="st">"Ridge"</span>,<span class="st">"Árbol unc."</span>, <span class="st">"Árbol post"</span>,</span>
<span id="cb29-2"><a href=""></a>           <span class="st">"Árbol pre"</span>,<span class="st">"Random forest"</span>,<span class="st">"Random forest cv"</span>,<span class="st">"xgb"</span>,<span class="st">"xgb cv"</span>)</span>
<span id="cb29-3"><a href=""></a>R2_train <span class="ot">=</span> <span class="fu">c</span>(r2_lm_train,r2_lasso_train,r2_ridge_train,</span>
<span id="cb29-4"><a href=""></a>             r2_unc_train, r2_post_train,r2_pre_train,r2_rf_train,</span>
<span id="cb29-5"><a href=""></a>             r2_rf_cv_train,r2_xgb_train,r2_xgb_cv_train)</span>
<span id="cb29-6"><a href=""></a>R2_test <span class="ot">=</span> <span class="fu">c</span>(r2_lm_test,r2_lasso_test,r2_ridge_test,</span>
<span id="cb29-7"><a href=""></a>            r2_unc_test, r2_post_test,r2_pre_test,r2_rf_test,</span>
<span id="cb29-8"><a href=""></a>            r2_rf_cv_test,r2_xgb_test,r2_xgb_cv_test)</span>
<span id="cb29-9"><a href=""></a></span>
<span id="cb29-10"><a href=""></a></span>
<span id="cb29-11"><a href=""></a>resultados <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Modelo,R2_train,R2_test)</span>
<span id="cb29-12"><a href=""></a>resultados <span class="sc">|&gt;</span> kableExtra<span class="sc">::</span><span class="fu">kbl</span>()</span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<table class="caption-top">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Modelo</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">R2_train</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">R2_test</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">LM</td>
<td style="text-align: right;">0.5752052</td>
<td style="text-align: right;">0.6057520</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lasso</td>
<td style="text-align: right;">0.5156971</td>
<td style="text-align: right;">0.5705224</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ridge</td>
<td style="text-align: right;">0.5628130</td>
<td style="text-align: right;">0.6005851</td>
</tr>
<tr class="even">
<td style="text-align: left;">Árbol unc.</td>
<td style="text-align: right;">0.9771030</td>
<td style="text-align: right;">0.4469618</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Árbol post</td>
<td style="text-align: right;">0.6463274</td>
<td style="text-align: right;">0.5882114</td>
</tr>
<tr class="even">
<td style="text-align: left;">Árbol pre</td>
<td style="text-align: right;">0.7917730</td>
<td style="text-align: right;">0.5941620</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Random forest</td>
<td style="text-align: right;">0.9466764</td>
<td style="text-align: right;">0.7073492</td>
</tr>
<tr class="even">
<td style="text-align: left;">Random forest cv</td>
<td style="text-align: right;">0.9458688</td>
<td style="text-align: right;">0.7133349</td>
</tr>
<tr class="odd">
<td style="text-align: left;">xgb</td>
<td style="text-align: right;">0.9004113</td>
<td style="text-align: right;">0.7079253</td>
</tr>
<tr class="even">
<td style="text-align: left;">xgb cv</td>
<td style="text-align: right;">0.9660560</td>
<td style="text-align: right;">0.7103404</td>
</tr>
</tbody>
</table>
</div>
</div>
</section></section><section><section id="interpretabilidad" class="title-slide slide level1 center" data-background-color="#115a72"><h1>Interpretabilidad</h1>

</section><section id="interpretabilidad-y-modelos-machine-learning" class="slide level2" style="color:#115a72"><h2>Interpretabilidad y modelos machine learning</h2>
<p>&nbsp;</p>

<img data-src="pics/interpret.png" class="r-stretch quarto-figure-center"><p class="caption">Fuente: An introduction to statistical learning</p></section><section id="valores-de-shapley-concepto" class="slide level2" style="color:#115a72"><h2>Valores de Shapley: concepto</h2>
<p>&nbsp;</p>
<p>Concepto de la teoría de juegos cooperativos. En ML se usa para atribuir a cada predictor su contribución a una predicción específica (dado un modelo .</p>
<ul>
<li>Se trata de una <strong>interpretación local</strong> (para una observación). En concreto la descomposión de Shapley <span class="math inline">\(\Phi^S(x_i;g)\)</span> de un modelo <span class="math inline">\(g\)</span> con <span class="math inline">\(p\)</span> predictores para el la predicción evaluada en <span class="math inline">\(x_i\)</span> es <span class="math display">\[\Phi^S(x_i;g)=\phi_0^S+\sum_{k=1}^p\phi^s_k(x_i)=g(x_i)\]</span>
<ul>
<li>
<span class="math inline">\(\phi^S_0=E[g(X)]\)</span> es el valor base o expectativa de la predicción del modelo (media de las predicciones del modelo)</li>
<li>
<span class="math inline">\(\phi^S_k\)</span> es la suma ponderada de la contribución marginal de la variable <span class="math inline">\(k\)</span> para todas las posibles combinaciones de variables <span class="math inline">\(x\)</span> al excluir la variable <span class="math inline">\(k\)</span>-ésima (<span class="math inline">\(C(\mathbf{x})\, \backslash \, k\)</span>)</li>
<li>los valores de Shapley son aditivos: para la predicción en <span class="math inline">\(x_i\)</span> suman <span class="math inline">\(g(x_i)\)</span>
</li>
</ul>
</li>
<li>Es posible construir una explicación global (a nivel de modelo) a partir de la distribución de los valores para las observaciones (de entrenamiento o prueba).</li>
</ul></section><section id="valores-de-shapley-ejemplo" class="slide level2" style="color:#115a72"><h2>Valores de Shapley: ejemplo</h2>
<p>&nbsp;</p>
<div class="panel-tabset">
<ul id="tabset-6" class="panel-tabset-tabby">
<li><a data-tabby-default="" href="#tabset-6-1">Explicación local</a></li>
<li><a href="#tabset-6-2">Explicación global</a></li>
<li><a href="#tabset-6-3">Efecto de un predictor e interacciones</a></li>
</ul>
<div class="tab-content">
<div id="tabset-6-1">
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Código</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href=""></a><span class="co"># Bibliotecas necesarias para la carga de datos </span></span>
<span id="cb30-2"><a href=""></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb30-3"><a href=""></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb30-4"><a href=""></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb30-5"><a href=""></a>url <span class="op">=</span> <span class="st">"https://juandmontoro.github.io/bigDataEco/data/airbnb.csv"</span></span>
<span id="cb30-6"><a href=""></a>df <span class="op">=</span> pd.read_csv(url)</span>
<span id="cb30-7"><a href=""></a></span>
<span id="cb30-8"><a href=""></a><span class="co"># TODAS las variables deben ser numéricas (si dummies son booleanas hay que convertir)</span></span>
<span id="cb30-9"><a href=""></a>df <span class="op">=</span> df.astype(np.float64)</span>
<span id="cb30-10"><a href=""></a>X <span class="op">=</span> df.drop(columns<span class="op">=</span>[<span class="st">'price'</span>])</span>
<span id="cb30-11"><a href=""></a>y <span class="op">=</span> np.log(df[<span class="st">'price'</span>]) </span>
<span id="cb30-12"><a href=""></a><span class="co"># Partición de datos</span></span>
<span id="cb30-13"><a href=""></a>X_train,X_test,y_train,y_test <span class="op">=</span> train_test_split(X,y,test_size<span class="op">=</span><span class="fl">0.2</span>,random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb30-14"><a href=""></a></span>
<span id="cb30-15"><a href=""></a><span class="co"># Importamos estimador y creamos una instancia para explicar el modelo</span></span>
<span id="cb30-16"><a href=""></a><span class="im">from</span> xgboost <span class="im">import</span> XGBRegressor</span>
<span id="cb30-17"><a href=""></a>xgb<span class="op">=</span> XGBRegressor(n_estimators<span class="op">=</span><span class="dv">10000</span>,</span>
<span id="cb30-18"><a href=""></a>                    learning_rate<span class="op">=</span><span class="fl">.0075</span>,</span>
<span id="cb30-19"><a href=""></a>                    colsample_bytree<span class="op">=</span><span class="fl">.5</span>, <span class="co"># muestrear predictores en la construccion de árbol</span></span>
<span id="cb30-20"><a href=""></a>                    colsample_bynode<span class="op">=</span><span class="fl">.25</span>,  <span class="co"># muestrear predictores en la particion de un nodo</span></span>
<span id="cb30-21"><a href=""></a>                    random_state<span class="op">=</span><span class="dv">42</span>,</span>
<span id="cb30-22"><a href=""></a>                    early_stopping_rounds<span class="op">=</span><span class="dv">1000</span>, <span class="co"># aseguramos que </span></span>
<span id="cb30-23"><a href=""></a>                    eval_metric<span class="op">=</span><span class="st">'rmse'</span></span>
<span id="cb30-24"><a href=""></a>                   )</span>
<span id="cb30-25"><a href=""></a>xgb.fit(</span>
<span id="cb30-26"><a href=""></a>    X_train, y_train,</span>
<span id="cb30-27"><a href=""></a>    eval_set<span class="op">=</span>[(X_test, y_test)],</span>
<span id="cb30-28"><a href=""></a>    verbose<span class="op">=</span><span class="va">False</span>)<span class="op">;</span></span>
<span id="cb30-29"><a href=""></a><span class="im">import</span> shap</span>
<span id="cb30-30"><a href=""></a>explainer <span class="op">=</span> shap.TreeExplainer(xgb)</span>
<span id="cb30-31"><a href=""></a><span class="co"># Explainers específicos para distintos tipos de modelos</span></span>
<span id="cb30-32"><a href=""></a><span class="co"># ver ayuda</span></span>
<span id="cb30-33"><a href=""></a></span>
<span id="cb30-34"><a href=""></a><span class="co"># Finalmente explicamos las predicciones del modelo</span></span>
<span id="cb30-35"><a href=""></a>explicacion <span class="op">=</span> explainer(X_test,check_additivity<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb30-36"><a href=""></a></span>
<span id="cb30-37"><a href=""></a>fig <span class="op">=</span> plt.figure()</span>
<span id="cb30-38"><a href=""></a>shap.plots.waterfall(explicacion[<span class="dv">1</span>],show<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb30-39"><a href=""></a>plt.gcf().set_size_inches(<span class="dv">20</span><span class="op">/</span><span class="fl">1.1</span>,<span class="dv">12</span><span class="op">/</span><span class="fl">1.1</span>)</span>
<span id="cb30-40"><a href=""></a>plt.show()</span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img data-src="economl_proyector_files/figure-revealjs/unnamed-chunk-20-1.png" class="quarto-figure quarto-figure-center" width="1745"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-2">
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Código</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href=""></a>fig <span class="op">=</span> plt.figure()</span>
<span id="cb31-2"><a href=""></a>shap.plots.beeswarm(explicacion, show<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb31-3"><a href=""></a>plt.gcf().set_size_inches(<span class="dv">20</span><span class="op">/</span><span class="fl">1.1</span>,<span class="dv">12</span><span class="op">/</span><span class="fl">1.1</span>)</span>
<span id="cb31-4"><a href=""></a>plt.show()</span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img data-src="economl_proyector_files/figure-revealjs/unnamed-chunk-21-3.png" class="quarto-figure quarto-figure-center" width="1745"></p>
</figure>
</div>
</div>
</div>
</div>
<div id="tabset-6-3">
<div class="cell" data-layout-align="center">
<details class="code-fold"><summary>Código</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href=""></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb32-2"><a href=""></a></span>
<span id="cb32-3"><a href=""></a>fig <span class="op">=</span> plt.figure()</span>
<span id="cb32-4"><a href=""></a>shap.plots.scatter(explicacion[:,<span class="st">'dist_centro'</span>],color<span class="op">=</span>explicacion,show<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb32-5"><a href=""></a>plt.xlim(<span class="dv">0</span>,<span class="dv">7</span>)<span class="op">;</span></span>
<span id="cb32-6"><a href=""></a>plt.gcf().set_size_inches(<span class="dv">20</span><span class="op">/</span><span class="fl">1.1</span>,<span class="dv">12</span><span class="op">/</span><span class="fl">1.1</span>)</span>
<span id="cb32-7"><a href=""></a>plt.show()</span></code></pre></div><button title="Copiar al portapapeles" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img data-src="economl_proyector_files/figure-revealjs/unnamed-chunk-22-5.png" class="quarto-figure quarto-figure-center" width="1745"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure><p><img data-src="economl_proyector_files/figure-revealjs/unnamed-chunk-22-6.png" class="quarto-figure quarto-figure-center" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section></section><section><section id="uso-de-datos-no-estructurados" class="title-slide slide level1 center" data-background-color="#115a72"><h1>Uso de datos no estructurados</h1>

</section><section class="slide level2">
<img data-src="pics/acei.png" class="r-stretch"></section><section id="etiquetas-lastfm" class="slide level2" style="color:#115a72"><h2>Etiquetas: <code>LastFM</code>
</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="pics/bad_bunny.png"></p>
</div><div class="column" style="width:50%;">
<p><img data-src="pics/taylor.png"></p>
</div></div>
</section><section id="artistas-como-vectores-en-el-espacio-de-etiquetas" class="slide level2" style="color:#115a72"><h2>Artistas como vectores en el espacio de etiquetas</h2>
<p>&nbsp;</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<thead><tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">artist</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">00s</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">10s</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2000s</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2010s</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">2020s</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">20s</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">3</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">4</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">&lt;3</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Awesome</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Ballad</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Brash</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Chill House</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Confident</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Confrontational</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Crap</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Favorite</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Female country</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Fiery</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Girls Night Out</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Guys Night Out</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Hip-Hop</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">House</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">I Heard This Artist Before</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Illinois</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Latin Electronic</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Latin Rap</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Latin Trap</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Latin Urban</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Love</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Motivation</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Pennsylvania</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Perreo</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Pro Wrestling</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Puerto Rican</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Reggaeton</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Skitz0rz</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Street-Smart</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Tough</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Trash</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">UK</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">USA</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Uncompromising</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Urbano Latino</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">World Music</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">acoustic</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">afrobeats</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">alternative</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">alternative rnb</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">alternative rock</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">amazing</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">american</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">annoying</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">at the beach</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">atmospheric</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">based</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">beautiful</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">bedroom pop</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">bomba</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">boring</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">bubblegrunge</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">bunny</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">catchy</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">chicago</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">chill</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">chillout</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">chillwave</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">city life</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">club</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">contemporary country</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">contemporary rnb</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">country</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">country pop</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">cute</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">dance</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">dance party</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">dancehall</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">deep house</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">dembow</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">diy</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">doo wop</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">dramatic</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">electropop</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">emo</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">emo pop</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">emo rap</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">emo-pop</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">english</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">explosive</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">fav888</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">female</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">female vocalist</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">female vocalists</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">folk</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">freak zone</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">gritty</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">guilty pleasure</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">hip hop</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">holloween skitz0rz</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">indie</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">indie folk</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">indie pop</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">indie rock</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">indie surf</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">intense</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">intimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">jangle pop</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">jazz</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">king of pop</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">late night</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">latin</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">latin pop</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">latino</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">latino/latina</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">legend</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">lovely</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">male vocalists</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">mischief</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">modern country</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">my dance room</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">my top songs</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">neoperreo</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">not emo</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">oldies</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">over 1 million listeners</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">overrated</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">partying</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">plena</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pop</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pop country</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pop punk</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pop rap</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">pop rock</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">power pop</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">professional wrestling</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">puerto rico</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">punk</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">raggaeton</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rap</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rnb</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rock</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">romantic</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">rubbish</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">salsa</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">seen live</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sex</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sexual</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">shit</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">singer-songwriter</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">slacker rock</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">spanish</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">spanish or latin artists</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">spanish rap</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">spicy</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sunflower</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">sweet</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">synthpop</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">synthwave</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">talented</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">taylor swift</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">teen pop</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">ten million plays</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">trap</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">trap latino</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">tropical house</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">twee pop</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">uitluisteren artist</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">urbano</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">us</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">world</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">worst of 2024</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">wrestling</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">wrestling-related</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">wwe</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">yandex music</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">('Bad Bunny', '4q3ewBCX7sLwd24euuV69X')</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">('Beach Bunny', '2vnB6tuQMaQpORiRdvXF9H')</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">32</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">85</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">27</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">53</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">('Mike Taylor', '30ejUciK31BCg0IVCbt1dW')</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">('Natalie Taylor', '2WxjxdeF7GGdcCK276qViY')</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">80</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="odd">
<td style="text-align: left;">('Taylor Swift', '06HL4z0CvFAxyc27GXpf02')</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">31</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">75</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section id="similitud-entre-artistas" class="slide level2" style="color:#115a72"><h2>Similitud entre artistas</h2>

<img data-src="economl_proyector_files/figure-revealjs/unnamed-chunk-25-1.png" width="1440" class="r-stretch"></section></section><section><section id="inferencia-causal" class="title-slide slide level1 center" data-background-color="#115a72"><h1>Inferencia causal</h1>

</section><section id="más-allá-de-la-predicción" class="slide level2" style="color:#115a72"><h2>Más allá de la predicción</h2>
<p>&nbsp;</p>
<p>¿Podemos usar modelos predictivos de aprendizaje automático para obtener estimadores de efectos causales insesgados con intervalos de confianza válidos?</p>
<ul>
<li>Doble aprendizaje automático (<em>Double machine learning</em>)<br>
</li>
<li>Modelos ML para estimación de efectos individuales:
<ul>
<li>Metalearners</li>
<li>Causal Forests</li>
</ul>
</li>
</ul>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>¿Por qué aprendizaje automático?</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Modelos de regresión en un espacio de características de alta dimensión</li>
<li>Relaciones no lineales entre respuesta <span class="math inline">\(Y\)</span>, covariables <span class="math inline">\(X\)</span> y tratamiento <span class="math inline">\(D\)</span><br>
</li>
<li>Uso de fuentes de datos alternativas: datos no estructurados (texto o imágenes)</li>
</ul>
<p><strong>¿Qué supuesto de identificación?</strong></p>
</div>
</div>
</div>
</section><section id="doubleml" class="slide level2 scrollable" style="color:#115a72"><h2>DoubleML</h2>
<p>&nbsp;</p>
<p>Consideramos el modelo lineal parcial y un problema de selección en observables:</p>
<p><span class="math display">\[
\begin{align}\begin{aligned}y = \tau \, D + g(X) + \epsilon, &amp; &amp;\epsilon \sim \mathcal{N}(0,1),\\ D = m(X) + v, &amp; &amp;v \sim \mathcal{N}(0,1),\end{aligned}\end{align}
\]</span></p>
<p>Si confusión es compleja y/o de alta dimensión, se puede estimar el parámetro causal <span class="math inline">\(\tau\)</span> (ATE) usando dos etapas.</p>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Double Machine Learning</strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li>Obtener estimadores <span class="math inline">\(E[y|X]=\hat{g}(X)\)</span> y <span class="math inline">\(E[D|X]=\hat{m}(X)\)</span>; usar para predecir <span class="math inline">\(\hat{y}\)</span> y <span class="math inline">\(\hat{D}\)</span>
</li>
<li>Generar versión residualizada de respuesta y tratamiento: <span class="math inline">\(\tilde{y}=y-\hat{y}\)</span> y <span class="math inline">\(\tilde{D}=D-\hat{D}\)</span>.</li>
<li>Regresar <span class="math inline">\(\tilde{y}\)</span> sobre <span class="math inline">\(\tilde{D}\)</span>.</li>
</ol>
</div>
</div>
</div>
</section><section id="causal-forests" class="slide level2" style="color:#115a72"><h2>Causal Forests</h2>
<p>&nbsp;</p>
<ul>
<li><p>Método de aprendizaje para inferencia causal que constituye una extensión de los <strong>Random Forests</strong> para la estimación de efectos heterogéneos (estimando: CATE)</p></li>
<li><p>En los bosques aleatorios, los datos se dividen repetidamente con el fin de minimizar el error de predicción de la respuesta.</p></li>
<li><p>Los bosques causales se construyen de manera similar, excepto que, en lugar de minimizar el error de predicción, los datos se dividen para maximizar la diferencia entre particiones en la relación entre la respuesta y un tratamiento.</p></li>
<li><p>El objetivo es identificar cómo varían los efectos del tratamiento a lo largo de la muestra.</p></li>
</ul>
<blockquote>
<p>Los bosques causales revelan la heterogeneidad en un efecto causal pero por sí mismos no garantizan que el efecto sea causal.</p>
</blockquote>
</section></section><section id="section" class="title-slide slide level1 center" data-background-color="#115a72"><h1></h1>


<img data-src="pics/machine_learning_2x.png" class="r-stretch quarto-figure-center"><p class="caption">Fuente: xkcd</p></section>
</div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="economl_proyector_files/libs/revealjs/dist/reveal.js"></script><!-- reveal.js plugins --><script src="economl_proyector_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script><script src="economl_proyector_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script><script src="economl_proyector_files/libs/revealjs/plugin/reveal-menu/menu.js"></script><script src="economl_proyector_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script><script src="economl_proyector_files/libs/revealjs/plugin/quarto-support/support.js"></script><script src="economl_proyector_files/libs/revealjs/plugin/notes/notes.js"></script><script src="economl_proyector_files/libs/revealjs/plugin/search/search.js"></script><script src="economl_proyector_files/libs/revealjs/plugin/zoom/zoom.js"></script><script src="economl_proyector_files/libs/revealjs/plugin/math/math.js"></script><script>window.define = window.backupDefine; window.backupDefine = undefined;</script><script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script><script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script><script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copiado");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copiado");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
            let selectedAnnoteEl;
            const selectorForAnnotation = ( cell, annotation) => {
              let cellAttr = 'data-code-cell="' + cell + '"';
              let lineAttr = 'data-code-annotation="' +  annotation + '"';
              const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
              return selector;
            }
            const selectCodeLines = (annoteEl) => {
              const doc = window.document;
              const targetCell = annoteEl.getAttribute("data-target-cell");
              const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
              const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
              const lines = annoteSpan.getAttribute("data-code-lines").split(",");
              const lineIds = lines.map((line) => {
                return targetCell + "-" + line;
              })
              let top = null;
              let height = null;
              let parent = null;
              if (lineIds.length > 0) {
                  //compute the position of the single el (top and bottom and make a div)
                  const el = window.document.getElementById(lineIds[0]);
                  top = el.offsetTop;
                  height = el.offsetHeight;
                  parent = el.parentElement.parentElement;
                if (lineIds.length > 1) {
                  const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
                  const bottom = lastEl.offsetTop + lastEl.offsetHeight;
                  height = bottom - top;
                }
                if (top !== null && height !== null && parent !== null) {
                  // cook up a div (if necessary) and position it 
                  let div = window.document.getElementById("code-annotation-line-highlight");
                  if (div === null) {
                    div = window.document.createElement("div");
                    div.setAttribute("id", "code-annotation-line-highlight");
                    div.style.position = 'absolute';
                    parent.appendChild(div);
                  }
                  div.style.top = top - 2 + "px";
                  div.style.height = height + 4 + "px";
                  div.style.left = 0;
                  let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
                  if (gutterDiv === null) {
                    gutterDiv = window.document.createElement("div");
                    gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                    gutterDiv.style.position = 'absolute';
                    const codeCell = window.document.getElementById(targetCell);
                    const gutter = codeCell.querySelector('.code-annotation-gutter');
                    gutter.appendChild(gutterDiv);
                  }
                  gutterDiv.style.top = top - 2 + "px";
                  gutterDiv.style.height = height + 4 + "px";
                }
                selectedAnnoteEl = annoteEl;
              }
            };
            const unselectCodeLines = () => {
              const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
              elementsIds.forEach((elId) => {
                const div = window.document.getElementById(elId);
                if (div) {
                  div.remove();
                }
              });
              selectedAnnoteEl = undefined;
            };
              // Handle positioning of the toggle
          window.addEventListener(
            "resize",
            throttle(() => {
              elRect = undefined;
              if (selectedAnnoteEl) {
                selectCodeLines(selectedAnnoteEl);
              }
            }, 10)
          );
          function throttle(fn, ms) {
          let throttle = false;
          let timer;
            return (...args) => {
              if(!throttle) { // first call gets through
                  fn.apply(this, args);
                  throttle = true;
              } else { // all the others get throttled
                  if(timer) clearTimeout(timer); // cancel #2
                  timer = setTimeout(() => {
                    fn.apply(this, args);
                    timer = throttle = false;
                  }, ms);
              }
            };
          }
            const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
            for (let i=0; i<annoteTargets.length; i++) {
              const annoteTarget = annoteTargets[i];
              const targetCell = annoteTarget.getAttribute("data-target-cell");
              const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
              const contentFn = () => {
                const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
                if (content) {
                  const tipContent = content.cloneNode(true);
                  tipContent.classList.add("code-annotation-tip-content");
                  return tipContent.outerHTML;
                }
              }
              const config = {
                allowHTML: true,
                content: contentFn,
                onShow: (instance) => {
                  selectCodeLines(instance.reference);
                  instance.reference.classList.add('code-annotation-active');
                  window.tippy.hideAll();
                },
                onHide: (instance) => {
                  unselectCodeLines();
                  instance.reference.classList.remove('code-annotation-active');
                },
                maxWidth: 300,
                delay: [50, 0],
                duration: [200, 0],
                offset: [5, 10],
                arrow: true,
                appendTo: function(el) {
                  return el.parentElement.parentElement.parentElement;
                },
                interactive: true,
                interactiveBorder: 10,
                theme: 'light-border',
                placement: 'right',
                popperOptions: {
                  modifiers: [
                  {
                    name: 'flip',
                    options: {
                      flipVariations: false, // true by default
                      allowedAutoPlacements: ['right'],
                      fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                    },
                  },
                  {
                    name: 'preventOverflow',
                    options: {
                      mainAxis: false,
                      altAxis: false
                    }
                  }
                  ]        
                }      
              };
              window.tippy(annoteTarget, config); 
            }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>


</body></html>